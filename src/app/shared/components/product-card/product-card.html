<div class="product-card"
     (click)="onProductClick()"
     role="button"
     tabindex="0"
     [class.out-of-stock]="!product.stock || product.stock <= 0"
     style="cursor: pointer;">
  <!-- IMAGE + BADGES -->
  <div class="product-image-wrapper">
    <img [src]="product.image" [alt]="product.title" class="product-image" loading="lazy">
    @if (product.discountPercentage && product.discountPercentage > 20) {
      <span class="badge badge-discount">-{{ product.discountPercentage }}%</span>
    }
    @if (product.isNew) {
      <span class="badge badge-new">Nouveau</span>
    }
    <div class="image-overlay"></div>
  </div>

  <!-- CORPS -->
  <div class="card-body">
    <h3 class="card-title">{{ product.title }}</h3>

    <div class="product-rating">
      <div class="stars">
        @for (star of getStars(); track star.index) {
          <span class="star"
                [class.filled]="star.isFilled"
                [class.half]="star.isHalf"
                [class.empty]="star.isEmpty">â˜…</span>
        }
      </div>
      <span class="rating-count">({{ product.rating?.count || 0 }})</span>
    </div>

    <!-- PRIX EN DT (SANS ERREUR DE LOCALE) -->
    <div class="price-container">
      <span *ngIf="product.discountPercentage" class="original-price">
        {{ originalPrice | number:'1.3-3' }} DT
      </span>
      <span class="current-price">
        {{ product.price | number:'1.3-3' }} DT
      </span>
    </div>

    <button class="btn-add-to-cart"
            (click)="onAddToCart(); $event.stopPropagation(); $event.preventDefault()"
            [disabled]="!product.stock || product.stock <= 0">
      Ajouter au panier
    </button>

    <!-- ACTIONS RAPIDES -->
    <div class="quick-actions">
     <button
  class="wishlist-btn"
  (click)="onToggleWishlist($event)"
  [title]="isWishlisted ? 'Retirer des favoris' : 'Ajouter aux favoris'"
  *ngIf="isLoggedIn">
  
  <span class="material-icons" [style.color]="isWishlisted ? '#e74c3c' : ''">
    {{ isWishlisted ? 'favorite' : 'favorite_border' }}
  </span>
</button>
      <button class="quick-buy-btn"
              (click)="onQuickBuy($event); $event.stopPropagation(); $event.preventDefault()"
              [disabled]="!product.stock || product.stock <= 0">
        Achat rapide
      </button>
    </div>
  </div>
</div>