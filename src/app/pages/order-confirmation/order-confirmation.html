<!-- src/app/pages/order-confirmation/order-confirmation.component.html (nettoyé et simplifié pour address string) -->
<div class="confirmation-page" *ngIf="!isLoading; else loadingTemplate">
  <div class="container">
    <div class="confirmation-header">
      <h1>Commande confirmée !</h1>
      <p>Merci pour votre achat. Votre commande #{{ order?.id }} a été enregistrée avec succès.</p>
    </div>

    <!-- Récapitulatif de la commande -->
    <div class="order-summary">
      <h2>Détails de la commande</h2>
      <div class="summary-items">
        @for (item of order?.items; track item.productId) {
          <div class="summary-item">
            @if (item.product!.images){

               <img [src]="item.product!.images[0]" [alt]="item.product?.title" class="item-image">
            }
            @else {
               <img src="/assets/fallback.jpg" [alt]="item.product?.title" class="item-image">
            }
            <div class="item-details">
              <h3>{{ item.product?.title }}</h3>
              <p>{{ item.quantity }} x {{ item.product?.price | currency:'TND' }}</p>
            </div>
            <span class="item-total">{{ getSubtotal(item) | currency:'TND' }}</span>
          </div>
        }
      </div>
      <div class="summary-totals">
        <div class="summary-row">
          <span>Sous-total</span>
          <span>{{ order?.subtotal | currency:'TND' }}</span>
        </div>
        <div class="summary-row">
          <span>Frais de livraison ({{ order?.deliveryMethod | titlecase }})</span>
          <span>{{ order?.shippingFee | currency:'TND' }}</span>
        </div>
        <div class="summary-row total">
          <span>Total</span>
          <strong>{{ order?.total | currency:'TND' }}</strong>
        </div>
      </div>
    </div>

    <!-- Adresse et livraison (simplifié pour address string) -->
    <div class="confirmation-details">
      <div class="detail-section">
        <h3>Adresse de livraison</h3>
        <p>{{ order?.shippingAddress }}</p>
      </div>
      <div class="detail-section">
        <h3>Détails de la livraison</h3>
        <p>Mode : {{ order?.deliveryMethod | titlecase }}</p>
        <p>Statut : {{ order?.status | titlecase }}</p>
        <p>Date de création : {{ order?.createdAt | date:'dd/MM/yyyy HH:mm' }}</p>
      </div>
    </div>

    <!-- Actions -->
    <div class="confirmation-actions">
      <a routerLink="/products" class="btn-continue">Continuer mes achats</a>
      <button class="btn-print" (click)="printOrder()">Imprimer la confirmation</button>
    </div>
  </div>
</div>

<!-- Loading -->
<ng-template #loadingTemplate>
  <div class="loading-container">
    <p>Chargement de la confirmation...</p>
  </div>
</ng-template>